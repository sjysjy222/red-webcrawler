<html>
<head>
    <meta charset="UTF-8">
    <h1><center>小红书评论搜索</h1></center>
</head>
<body>
<div id="input_area"><center>
    <p>输入cookie</p>
    <input id="cookie">
    <p>输入url口令</p>
    <input id="url">
    <p>输入关键词</p>
    <input id="keyword">
    <p><button onclick="submitData()">提交</button></p>
</div></center>

<div id="notice" style="max-height: 400px; overflow-y: auto; border: 1px solid #ccc; padding: 10px;">
  <h3>最新通知</h3>
  <div id="notice-list">暂无通知</div>
</div>

<div id="latest-comments" style="max-height: 400px; overflow-y: auto; border: 1px solid #ccc; padding: 10px;">
  <h3>最新评论</h3>
  <div id="comments-list">暂无评论</div>
</div>

<div id="result" style="max-height: 400px; overflow-y: auto; border: 1px solid #ccc; padding: 10px;"><h3>分析结果</h3></div>

<script>
  // 定时请求最新评论接口，更新显示
  function fetchLatestComments() {
    fetch('http://127.0.0.1:5000/get_latest_comments')
      .then(response => response.json())
      .then(data => {
        const comments = data.comments;
        const container = document.getElementById('comments-list');
        if (comments.length === 0) {
          container.innerHTML = '<p>暂无评论</p>';
          return;
        }
        // 把每条评论用 <p> 包裹，按顺序显示
        container.innerHTML = comments.map((c, i) => `<p>${i + 1}. ${c}</p>`).join('');
      })
      .catch(err => {
        console.error('获取最新评论失败:', err);
      });
  }

  // 页面加载后，立刻获取一次，然后每3秒更新一次
  fetchLatestComments();
  setInterval(fetchLatestComments, 3000);
</script>

<script>
  // 定时请求最新通知，更新显示
  function fetchLatestnotice() {
    fetch('http://127.0.0.1:5000/get_latest_notice')
      .then(response => response.json())
      .then(data => {
        const notice = data.notice;
        const container_n = document.getElementById('notice-list');
        if (notice.length === 0) {
          container_n.innerHTML = '<p>暂无通知</p>';
          return;
        }
        // 把每条评论用 <p> 包裹，按顺序显示
        container_n.innerHTML = notice.map((c, i) => `<p>${i + 1}. ${c}</p>`).join('');
      })
      .catch(err => {
        console.error('获取最新通知失败:', err);
      });
  }

  // 页面加载后，立刻获取一次，然后每3秒更新一次
  fetchLatestnotice();
  setInterval(fetchLatestnotice, 1000);
</script>


<script>
        function submitData() {
            const cookie = document.getElementById('cookie').value;
            const url = document.getElementById('url').value;
            const keyword = document.getElementById('keyword').value;
            document.getElementById('notice-list').innerHTML = '';
            document.getElementById('comments-list').innerHTML = '';
            
            fetch('http://127.0.0.1:5000/process', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    cookie: cookie,
                    url: url,
                    keyword: keyword
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log('后端返回数据:', data);
                document.getElementById('result').innerHTML = `
                    <h2>结果</h2>
                    <p>总评论数: ${data.comment_length}</p>
                    <p>搜索到 ${data.matched_case_number} 条匹配结果</p>
                    <p>关键词TF-IDF分析:</p>
                    <p>${data.tfidf_importance}</p>
                    <p>词云:</p>
                    <img src="${data.word_cloud_image}" style="max-width: 80%;">
                `;
            })
            .catch(error => {
                console.error('请求错误:', error);
                alert('请求失败，请检查后端是否运行');
            });
        }
    </script>
</body>
</html>
